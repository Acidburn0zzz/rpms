--- xine-lib-1.1.5/m4/pthreads.m4~	2007-04-05 01:18:00.000000000 +0300
+++ xine-lib-1.1.5/m4/pthreads.m4	2007-04-05 01:18:00.000000000 +0300
@@ -36,11 +36,15 @@
     [ac_save_CFLAGS="$CFLAGS"
      ac_save_LIBS="$LIBS"
      CFLAGS="$CFLAGS $cc_cv_werror $PTHREAD_CFLAGS"
+     
      LIBS="$LIBS $PTHREAD_LIBS"
-     AC_COMPILE_IFELSE(
+     AC_LINK_IFELSE(
        [AC_LANG_PROGRAM(
-          [[#include <pthread.h>]],
-          [[pthread_create(NULL, NULL, NULL, NULL);]]
+          [[#include <pthread.h>
+	    void *fakethread(void *arg) { return NULL; }
+	    pthread_t fakevariable;
+	  ]],
+          [[pthread_create(&fakevariable, NULL, &fakethread, NULL);]]
         )],
        [cc_cv_pthreads=yes],
        [cc_cv_pthreads=no])
--- xine-lib-1.1.5/configure~	2007-04-10 01:25:56.000000000 +0300
+++ xine-lib-1.1.5/configure	2007-04-10 01:25:56.000000000 +0300
@@ -26074,14 +26074,15 @@
      esac
   fi
 
-  { echo "$as_me:$LINENO: checking if $CC supports Pthread" >&5
-echo $ECHO_N "checking if $CC supports Pthread... $ECHO_C" >&6; }
+  echo "$as_me:$LINENO: checking if $CC supports Pthread" >&5
+echo $ECHO_N "checking if $CC supports Pthread... $ECHO_C" >&6
 if test "${cc_cv_pthreads+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_save_CFLAGS="$CFLAGS"
      ac_save_LIBS="$LIBS"
      CFLAGS="$CFLAGS $cc_cv_werror $PTHREAD_CFLAGS"
+
      LIBS="$LIBS $PTHREAD_LIBS"
      cat >conftest.$ac_ext <<_ACEOF
 /* confdefs.h.  */
@@ -26090,47 +26091,55 @@
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
 #include <pthread.h>
+	    void *fakethread(void *arg) { return NULL; }
+	    pthread_t fakevariable;
+
 int
 main ()
 {
-pthread_create(NULL, NULL, NULL, NULL);
+pthread_create(&fakevariable, NULL, &fakethread, NULL);
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
   cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"
+			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
   cc_cv_pthreads=yes
 else
   echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
 
-	cc_cv_pthreads=no
+cc_cv_pthreads=no
 fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+rm -f conftest.err conftest.$ac_objext \
+      conftest$ac_exeext conftest.$ac_ext
      CFLAGS="$ac_save_CFLAGS"
      LIBS="$ac_save_LIBS"
 
 fi
-{ echo "$as_me:$LINENO: result: $cc_cv_pthreads" >&5
-echo "${ECHO_T}$cc_cv_pthreads" >&6; }
+echo "$as_me:$LINENO: result: $cc_cv_pthreads" >&5
+echo "${ECHO_T}$cc_cv_pthreads" >&6
 
 
 
